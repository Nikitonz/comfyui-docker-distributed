FROM pytorch/pytorch:2.9.1-cuda12.8-cudnn9-devel

RUN apt-get update && apt-get install -y \
    git python3-dev python3-venv python3-pip dos2unix nano \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app/ComfyUI
	
RUN git clone https://github.com/comfyanonymous/ComfyUI.git . \
    && pip install --no-cache-dir -r requirements.txt

RUN git clone https://github.com/robertvoy/ComfyUI-Distributed.git custom_nodes/ComfyUI-Distributed

COPY extra_model_paths.yaml /app/ComfyUI/extra_model_paths.yaml

EXPOSE 8188

CMD python3 main.py \
    --listen 0.0.0.0 \
    --port 8188 \
    --disable-auto-launch \
    --normalvram \
    --cache-lru 2 \
    --async-offload
